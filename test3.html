<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIYexhibition</title>
    <link href="/diyexhibition/style.css" rel="stylesheet" type="text/css" media="all">
    <style>
			body { margin: 0; }
			canvas { display: block; }
		</style>
  </head>
  <body>
		<a class="back" href="/diyexhibition/homepage.html">back</a>
    <script type="module">
			import * as THREE from "/diyexhibition/build/three.module.js";
			import { PointerLockControls } from "/diyexhibition/js/PointerLockControls.js";
			
			var scene = new THREE.Scene();
			scene.background = new THREE.Color(0x495261);
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
      
      var renderer = new THREE.WebGLRenderer();
      renderer.setSize( window.innerWidth, window.innerHeight );
      document.body.appendChild( renderer.domElement );
      
      var controls=new PointerLockControls(camera,document.body);
      
      var forward=0;
      var sideways=0;
      var speed=0.05;
      
      var context=false;
			
			function keyPress(event){
		    switch(event.keyCode){
		      case 87:
		        forward=1;
		        break;
	        case 83:
		        forward=-1;
		        break;
	        case 65:
		        sideways=-1;
		        break;
	        case 68:
		        sideways=1;
		        break;
		    }
			}
			
			function keyRelease(event){
		    switch(event.keyCode){
		      case 87:
		        forward=0;
		        break;
	        case 83:
		        forward=0;
		        break;
	        case 65:
		        sideways=0;
		        break;
	        case 68:
		        sideways=0;
		        break;
		    }
			}
			
			document.addEventListener("keydown",keyPress);
			document.addEventListener("keyup",keyRelease);
			document.addEventListener("click",function(){controls.lock();});
			document.addEventListener("click",audio);

      var material1=new THREE.MeshPhongMaterial({color:0x4287F5});
      var material2=new THREE.MeshPhongMaterial({color:0x0de046});
      var material3=new THREE.MeshPhongMaterial({color:0x2d0de0});
      var material4=new THREE.MeshPhongMaterial({color:0xff73dc});
      var material5=new THREE.MeshPhongMaterial({color:0xf3ff73});
      var wallGeo=new THREE.PlaneGeometry(5,2);
      var floorGeo=new THREE.PlaneGeometry(5,5);
      var wall1=new THREE.Mesh(wallGeo,material1);
      var wall2=new THREE.Mesh(wallGeo,material2);
      var wall3=new THREE.Mesh(wallGeo,material3);
      var wall4=new THREE.Mesh(wallGeo,material4);
      var floor=new THREE.Mesh(floorGeo,material5);
      var ceiling=new THREE.Mesh(floorGeo,material5);
      
      var light=new THREE.PointLight(0xFFFFFF,0.2);
      
      scene.add(wall1);
      scene.add(wall2);
      scene.add(wall3);
      scene.add(wall4);
      scene.add(floor);
      scene.add(ceiling);
      scene.add(light);
      scene.add(controls.getObject());
      
      camera.position.x = 0;
      camera.position.y = 0;
      camera.position.z = 2.5;
      
      wall2.rotation.y=Math.PI/2;
      wall2.position.x=-2.5;
      wall2.position.z=2.5;
      
      wall3.rotation.y=-Math.PI/2;
      wall3.position.x=2.5;
      wall3.position.z=2.5;
      
      wall4.rotation.y=Math.PI;
      wall4.position.z=5;
      
      floor.rotation.x=-Math.PI/2;
      floor.position.y=-1;
      floor.position.z=2.5;
      
      ceiling.rotation.x=Math.PI/2;
      ceiling.position.y=1;
      ceiling.position.z=2.5;
      
      function audio(){
				if(!context){
					var listener=new THREE.AudioListener();
					camera.add(listener);
					var audioLoader=new THREE.AudioLoader();

					var sound1=new THREE.PositionalAudio(listener);
					audioLoader.load("sounds/fifths.wav",function(buffer){
						sound1.setBuffer(buffer);
						sound1.setLoop(true);
						sound1.setVolume(0.4);
						sound1.play();
					});
					wall1.add(sound1);

					var sound2=new THREE.PositionalAudio(listener);
					audioLoader.load("sounds/wind.wav",function(buffer){
						sound2.setBuffer(buffer);
						sound2.setLoop(true);
						sound2.setVolume(0.4);
						sound2.play();
					});
					wall2.add(sound2);

					var sound3=new THREE.PositionalAudio(listener);
					audioLoader.load("sounds/voice.wav",function(buffer){
						sound3.setBuffer(buffer);
						sound3.setLoop(true);
						sound3.setVolume(0.2);
						sound3.play();
					});
					wall3.add(sound3);

					var sound4=new THREE.PositionalAudio(listener);
					audioLoader.load("sounds/tape.wav",function(buffer){
						sound4.setBuffer(buffer);
						sound4.setLoop(true);
						sound4.setVolume(0.3);
						sound4.play();
					});
					wall4.add(sound4);

					context=true;
		  	}
	  	}
      
      function animate(){
      	requestAnimationFrame( animate );
      	renderer.render( scene, camera );
        controls.moveForward(forward*speed);
        controls.moveRight(sideways*speed);
        camera.position.x=Math.min(Math.max(camera.position.x,-2.3,),2.3);
        camera.position.z=Math.min(Math.max(camera.position.z,0.2,),4.8);
        light.position.set(camera.position.x,camera.position.y,camera.position.z);
      }
      
      animate();
		</script>
  </body>
</html>
